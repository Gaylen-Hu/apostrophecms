# æ–°é—»åˆ—è¡¨é¡µæ›´æ–°è¯´æ˜

## âœ… å·²å®Œæˆçš„æ›´æ–°

æ ¹æ® ApostropheCMS å®˜æ–¹æ–‡æ¡£æ ‡å‡†ï¼Œå·²ä¸ºæ–°é—»åˆ—è¡¨é¡µæ·»åŠ å®Œæ•´çš„æœç´¢å’Œç­›é€‰åŠŸèƒ½ã€‚

## ğŸ¯ æ›´æ–°å†…å®¹

### 1. **å¯ç”¨æœç´¢åŠŸèƒ½** âœ…

#### åç«¯é…ç½®

**æ–‡ä»¶**: `modules/news-page/index.js`

```javascript
options: {
  label: 'æ–°é—»æ–‡ç« ',
  pluralLabel: 'æ–°é—»æ–‡ç« ',
  searchable: true  // â† æ–°å¢ï¼šå¯ç”¨æœç´¢
}
```

**å¯æœç´¢å­—æ®µ**ï¼š
- `title` - æ ‡é¢˜ï¼ˆç³»ç»Ÿé»˜è®¤ï¼‰
- `author` - ä½œè€…
- `excerpt` - æ‘˜è¦

### 2. **æ·»åŠ  `piecesFilters` é…ç½®** âœ…

**æ–‡ä»¶**: `modules/news-page-page/index.js`

```javascript
options: {
  label: 'æ–°é—»åˆ—è¡¨é¡µ',
  perPage: 9,
  piecesFilters: [        // â† æ–°å¢
    {
      name: 'category'    // åˆ†ç±»ç­›é€‰
    },
    {
      name: 'isFeatured'  // ç½®é¡¶ç­›é€‰
    }
  ]
}
```

### 3. **æ·»åŠ  `indexQuery` æ–¹æ³•** âœ…

**æ–‡ä»¶**: `modules/news-page-page/index.js`

```javascript
extendMethods(self) {
  return {
    indexQuery(_super, req) {
      const query = _super(req);
      
      // å¤„ç†æœç´¢å‚æ•°
      if (req.query.search) {
        return query.search(req.query.search);
      }
      
      return query;
    },
    // ... å…¶ä»–æ–¹æ³•
  };
}
```

### 4. **å®Œå–„æœç´¢æ¡†** âœ…

**æ–‡ä»¶**: `modules/news-page-page/views/index.html`

#### æœç´¢æ¡†åŠŸèƒ½ï¼š
- âœ… æ˜¾ç¤ºå½“å‰æœç´¢å…³é”®è¯
- âœ… æ”¯æŒå›è½¦é”®æœç´¢
- âœ… æ”¯æŒè‡ªåŠ¨æœç´¢ï¼ˆé˜²æŠ–500msï¼‰
- âœ… æ¸…ç©ºæ—¶é‡ç½®æœç´¢

#### JavaScript å®ç°ï¼š
```javascript
document.addEventListener('DOMContentLoaded', function() {
  const searchInput = document.getElementById('newsSearch');
  
  // å›è½¦æœç´¢
  searchInput.addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      performSearch();
    }
  });
  
  // è‡ªåŠ¨æœç´¢ï¼ˆé˜²æŠ–ï¼‰
  let searchTimeout;
  searchInput.addEventListener('input', function() {
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(performSearch, 500);
  });
});
```

### 5. **æ·»åŠ ç©ºçŠ¶æ€æç¤º** âœ…

å½“æ²¡æœ‰æ–°é—»æ—¶ï¼Œæ˜¾ç¤ºå‹å¥½çš„æç¤ºï¼š

```html
<div class="text-center py-20">
  <i class="fa-solid fa-folder-open text-gray-300 text-6xl mb-6"></i>
  <h3 class="text-2xl font-bold text-gray-700 mb-3">æš‚æ— æ–°é—»</h3>
  <p class="text-gray-500 mb-6">
    {% if data.query.search %}
      æœªæ‰¾åˆ°ç¬¦åˆ"{{ data.query.search }}"çš„æ–°é—»
    {% else %}
      å½“å‰åˆ†ç±»ä¸‹è¿˜æ²¡æœ‰æ–°é—»ï¼Œè¯·æŸ¥çœ‹å…¶ä»–åˆ†ç±»
    {% endif %}
  </p>
  <a href="{{ data.page._url }}" class="...">è¿”å›å…¨éƒ¨æ–°é—»</a>
</div>
```

## ğŸ“‹ å®Œæ•´åŠŸèƒ½æ¸…å•

### æœç´¢åŠŸèƒ½
- âœ… æœç´¢æ¡†åœ¨é¡µé¢é¡¶éƒ¨
- âœ… æ”¯æŒå›è½¦é”®æœç´¢
- âœ… æ”¯æŒè‡ªåŠ¨æœç´¢ï¼ˆè¾“å…¥åœæ­¢500msåï¼‰
- âœ… æ˜¾ç¤ºå½“å‰æœç´¢è¯
- âœ… å¯æœç´¢å­—æ®µï¼šæ ‡é¢˜ã€ä½œè€…ã€æ‘˜è¦

### ç­›é€‰åŠŸèƒ½
- âœ… åˆ†ç±»ç­›é€‰ï¼ˆå…¬å¸åŠ¨æ€ã€è¡Œä¸šèµ„è®¯ã€äº§å“å‘å¸ƒã€æŠ€æœ¯åˆ†äº«ã€å…¶ä»–ï¼‰
- âœ… ç½®é¡¶ç­›é€‰
- âœ… ç‚¹å‡»åˆ‡æ¢åˆ†ç±»
- âœ… æ¿€æ´»çŠ¶æ€é«˜äº®æ˜¾ç¤º
- âœ… URL å‚æ•°æ”¯æŒ

### åˆ†é¡µåŠŸèƒ½
- âœ… æ¯é¡µæ˜¾ç¤º9ä¸ªæ–°é—»
- âœ… æ˜¾ç¤ºå½“å‰é¡µç 
- âœ… ä¸Šä¸€é¡µ/ä¸‹ä¸€é¡µæŒ‰é’®
- âœ… æ˜¾ç¤ºå¤šä¸ªé¡µç ï¼ˆæœ€å¤š5ä¸ªï¼‰

### ç”¨æˆ·ä½“éªŒ
- âœ… å“åº”å¼å¸ƒå±€ï¼ˆ1/2/3åˆ—ï¼‰
- âœ… ç©ºçŠ¶æ€å‹å¥½æç¤º
- âœ… æœç´¢ç»“æœæç¤º
- âœ… å¹³æ»‘è¿‡æ¸¡åŠ¨ç”»

## ğŸ“‚ ä¿®æ”¹çš„æ–‡ä»¶

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ |
|------|---------|
| `modules/news-page/index.js` | â‘  æ·»åŠ  searchable: true<br>â‘¡ æ ‡è®°å¯æœç´¢å­—æ®µ |
| `modules/news-page-page/index.js` | â‘  æ·»åŠ  piecesFilters<br>â‘¡ æ·»åŠ  indexQuery æ–¹æ³• |
| `modules/news-page-page/views/index.html` | â‘  æœç´¢æ¡†ç»‘å®šåŠŸèƒ½<br>â‘¡ æ·»åŠ æœç´¢JavaScript<br>â‘¢ æ·»åŠ ç©ºçŠ¶æ€å¤„ç† |

## ğŸ” æŠ€æœ¯å®ç°

### æœç´¢å·¥ä½œæµç¨‹

1. ç”¨æˆ·åœ¨æœç´¢æ¡†è¾“å…¥å…³é”®è¯
2. JavaScript æ•è·è¾“å…¥äº‹ä»¶
3. é˜²æŠ–ç­‰å¾…500msï¼ˆé¿å…é¢‘ç¹è¯·æ±‚ï¼‰
4. æ›´æ–° URLï¼š`/news?search=å…³é”®è¯`
5. åç«¯ `indexQuery` æ£€æµ‹åˆ°å‚æ•°
6. è°ƒç”¨ `query.search()` æŸ¥è¯¢æ„å»ºå™¨
7. åœ¨ titleã€authorã€excerpt å­—æ®µä¸­æœç´¢
8. è¿”å›åŒ¹é…çš„æ–°é—»

### ç­›é€‰å·¥ä½œæµç¨‹

1. ç”¨æˆ·ç‚¹å‡»åˆ†ç±»æŒ‰é’®
2. URL å˜ä¸ºï¼š`/news?category=company`
3. `piecesFilters` é…ç½®å‘Šè¯‰ç³»ç»Ÿè¿™æ˜¯æœ‰æ•ˆçš„ç­›é€‰å™¨
4. åç«¯è‡ªåŠ¨åº”ç”¨ `category` æŸ¥è¯¢æ„å»ºå™¨
5. è¿”å›è¯¥åˆ†ç±»çš„æ–°é—»

### ç»„åˆæœç´¢å’Œç­›é€‰

```
/news?category=company&search=æ–°å‚åŒº
```

ç»“æœï¼šæ˜¾ç¤º"å…¬å¸åŠ¨æ€"åˆ†ç±»ä¸­åŒ…å«"æ–°å‚åŒº"çš„æ–°é—»ã€‚

## ğŸš€ ä½¿ç”¨æŒ‡å—

### æµ‹è¯•æœç´¢åŠŸèƒ½

1. è®¿é—® `http://localhost:3000/news`
2. åœ¨æœç´¢æ¡†è¾“å…¥å…³é”®è¯ï¼ˆå¦‚"æœºæ¢°"ï¼‰
3. æŒ‰å›è½¦æˆ–ç­‰å¾…è‡ªåŠ¨æœç´¢
4. æŸ¥çœ‹æœç´¢ç»“æœ

### æµ‹è¯•åˆ†ç±»ç­›é€‰

1. ç‚¹å‡»"å…¬å¸åŠ¨æ€"æŒ‰é’®
2. æŸ¥çœ‹æ˜¯å¦åªæ˜¾ç¤ºå…¬å¸åŠ¨æ€ç±»æ–°é—»
3. URL åº”å˜ä¸º `/news?category=company`

### æµ‹è¯•ç½®é¡¶ç­›é€‰

1. ç‚¹å‡»"ç½®é¡¶æ–°é—»"æŒ‰é’®
2. æŸ¥çœ‹æ˜¯å¦åªæ˜¾ç¤ºç½®é¡¶çš„æ–°é—»
3. URL åº”å˜ä¸º `/news?isFeatured=true`

### æµ‹è¯•ç©ºçŠ¶æ€

1. æœç´¢ä¸€ä¸ªä¸å­˜åœ¨çš„å…³é”®è¯
2. åº”æ˜¾ç¤º"æœªæ‰¾åˆ°ç¬¦åˆxxxçš„æ–°é—»"æç¤º

### æµ‹è¯•åˆ†é¡µ

1. åˆ›å»º9ä¸ªä»¥ä¸Šçš„æ–°é—»
2. è®¿é—®åˆ—è¡¨é¡µ
3. åº”è¯¥æ˜¾ç¤ºåˆ†é¡µå™¨
4. ç‚¹å‡»é¡µç æµ‹è¯•ç¿»é¡µ

## ğŸ“Š å¯¹æ¯”ï¼šæ›´æ–°å‰å

| åŠŸèƒ½ | æ›´æ–°å‰ | æ›´æ–°å |
|------|--------|--------|
| æœç´¢åŠŸèƒ½ | âŒ æ— ï¼ˆåªæœ‰é™æ€æœç´¢æ¡†ï¼‰ | âœ… å®Œæ•´æœç´¢ |
| piecesFilters | âŒ æ—  | âœ… å·²é…ç½® |
| indexQuery | âŒ æ—  | âœ… æ”¯æŒæœç´¢ |
| ç©ºçŠ¶æ€ | âŒ æ—  | âœ… æ™ºèƒ½æç¤º |
| æœç´¢æ¡†åŠŸèƒ½ | âŒ è£…é¥°æ€§ | âœ… å®Œå…¨å¯ç”¨ |
| URLå‚æ•°ç­›é€‰ | âŒ éƒ¨åˆ† | âœ… å®Œæ•´æ”¯æŒ |

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### æœç´¢ç¤ºä¾‹

```
æœç´¢"æœºæ¢°"     â†’ /news?search=æœºæ¢°
æœç´¢"æ–°å‚åŒº"   â†’ /news?search=æ–°å‚åŒº
æœç´¢"æŠ€æœ¯"     â†’ /news?search=æŠ€æœ¯
```

### ç­›é€‰ç¤ºä¾‹

```
å…¬å¸åŠ¨æ€       â†’ /news?category=company
è¡Œä¸šèµ„è®¯       â†’ /news?category=industry
ç½®é¡¶æ–°é—»       â†’ /news?isFeatured=true
```

### ç»„åˆç¤ºä¾‹

```
å…¬å¸åŠ¨æ€+æœç´¢"å‚åŒº"  â†’ /news?category=company&search=å‚åŒº
è¡Œä¸šèµ„è®¯+ç¬¬2é¡µ       â†’ /news?category=industry&page=2
```

## ğŸ¨ åŠŸèƒ½ç‰¹ç‚¹

### æœç´¢ç‰¹æ€§
- âœ… å®æ—¶æœç´¢ï¼ˆé˜²æŠ–ä¼˜åŒ–ï¼‰
- âœ… æ”¯æŒä¸­è‹±æ–‡
- âœ… éƒ¨åˆ†åŒ¹é…
- âœ… è·¨å­—æ®µæœç´¢

### ç­›é€‰ç‰¹æ€§
- âœ… å¤šç»´åº¦ç­›é€‰
- âœ… å¯ç»„åˆä½¿ç”¨
- âœ… URL å‚æ•°æŒä¹…åŒ–
- âœ… æ¿€æ´»çŠ¶æ€å¯è§†åŒ–

### åˆ†é¡µç‰¹æ€§
- âœ… è‡ªåŠ¨åˆ†é¡µ
- âœ… é¡µç å¯¼èˆª
- âœ… ä¸Šä¸€é¡µ/ä¸‹ä¸€é¡µ
- âœ… ä¿ç•™ç­›é€‰çŠ¶æ€

## ğŸ”§ æ‰©å±•å»ºè®®

### æ·»åŠ æ—¥æœŸèŒƒå›´ç­›é€‰

åœ¨ `news-page-page/index.js` ä¸­ï¼š

```javascript
piecesFilters: [
  { name: 'category' },
  { name: 'isFeatured' },
  { name: 'publishDate' }  // æ·»åŠ æ—¥æœŸç­›é€‰
]
```

### æ·»åŠ ä½œè€…ç­›é€‰

```javascript
piecesFilters: [
  // ... ç°æœ‰ç­›é€‰å™¨
  { name: 'author' }  // æ·»åŠ ä½œè€…ç­›é€‰
]
```

### è‡ªå®šä¹‰æ’åº

åœ¨ `indexQuery` ä¸­æ·»åŠ ï¼š

```javascript
indexQuery(_super, req) {
  const query = _super(req);
  
  if (req.query.search) {
    query.search(req.query.search);
  }
  
  // è‡ªå®šä¹‰æ’åº
  if (req.query.sort === 'date') {
    query.sort({ publishDate: -1 });
  } else if (req.query.sort === 'title') {
    query.sort({ title: 1 });
  }
  
  return query;
}
```

## ğŸ› æ•…éšœæ’æŸ¥

### æœç´¢ä¸å·¥ä½œï¼Ÿ

1. âœ… ç¡®è®¤ `searchable: true` å·²é…ç½®
2. âœ… ç¡®è®¤å­—æ®µæ ‡è®°ä¸º `searchable: true`
3. âœ… æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°
4. âœ… é‡å¯åº”ç”¨

### ç­›é€‰ä¸å·¥ä½œï¼Ÿ

1. âœ… ç¡®è®¤ `piecesFilters` å·²é…ç½®
2. âœ… ç¡®è®¤æ–°é—»æœ‰ category å€¼
3. âœ… æ£€æŸ¥ URL å‚æ•°
4. âœ… æŸ¥çœ‹åç«¯æ—¥å¿—

### åˆ†é¡µå™¨ä¸æ˜¾ç¤ºï¼Ÿ

1. âœ… ç¡®è®¤æ–°é—»æ€»æ•° > 9 ä¸ª
2. âœ… æ£€æŸ¥ `perPage: 9` é…ç½®
3. âœ… æŸ¥çœ‹ `data.totalPages` å€¼

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [ApostropheCMS Piece Pages æ–‡æ¡£](https://docs.apostrophecms.org/guide/piece-pages.html)
- [piecesFilters é…ç½®å‚è€ƒ](https://docs.apostrophecms.org/reference/modules/piece-page-type.html#piecesfilters)
- [æ•°æ®åº“æŸ¥è¯¢æ–‡æ¡£](https://docs.apostrophecms.org/guide/database-queries.html)

## ğŸ¯ ä¸æ¡ˆä¾‹é¡µé¢çš„å¯¹æ¯”

ä¸¤ä¸ªåˆ—è¡¨é¡µç°åœ¨å…·æœ‰ç›¸åŒçš„åŠŸèƒ½ï¼š

| åŠŸèƒ½ | æ–°é—»åˆ—è¡¨é¡µ | æ¡ˆä¾‹åˆ—è¡¨é¡µ |
|------|----------|----------|
| æœç´¢åŠŸèƒ½ | âœ… | âœ… |
| åˆ†ç±»ç­›é€‰ | âœ… | âœ… |
| ç½®é¡¶/æ¨èç­›é€‰ | âœ… | âœ… |
| åˆ†é¡µåŠŸèƒ½ | âœ… | âœ… |
| ç©ºçŠ¶æ€æç¤º | âœ… | âœ… |
| æ¯é¡µæ•°é‡ | 9ä¸ª | 6ä¸ª |

## ğŸš€ ç«‹å³æµ‹è¯•

### 1. é‡å¯åº”ç”¨

```bash
# æŒ‰ Ctrl+C åœæ­¢
npm run dev
```

### 2. è®¿é—®æ–°é—»åˆ—è¡¨é¡µ

```
http://localhost:3000/news
```

### 3. æµ‹è¯•åŠŸèƒ½

âœ… **æœç´¢**: è¾“å…¥"æœºæ¢°"æˆ–"æ–°å‚åŒº"  
âœ… **ç­›é€‰**: ç‚¹å‡»"å…¬å¸åŠ¨æ€"  
âœ… **ç½®é¡¶**: ç‚¹å‡»"ç½®é¡¶æ–°é—»"  
âœ… **åˆ†é¡µ**: å¦‚æœæœ‰9ä¸ªä»¥ä¸Šæ–°é—»ï¼Œæµ‹è¯•ç¿»é¡µ

## ğŸ“ æ€»ç»“

### æ–°å¢åŠŸèƒ½
- âœ… å®Œæ•´çš„æœç´¢åŠŸèƒ½
- âœ… æ ‡å‡†çš„ piecesFilters é…ç½®
- âœ… ç¬¦åˆæ–‡æ¡£çš„ indexQuery å®ç°
- âœ… ç©ºçŠ¶æ€å‹å¥½æç¤º
- âœ… æœç´¢æ¡†å®æ—¶åé¦ˆ

### æ”¹è¿›ç‚¹
- âœ… ä»é™æ€æœç´¢æ¡†å˜ä¸ºå¯ç”¨çš„æœç´¢åŠŸèƒ½
- âœ… æ·»åŠ äº† URL å‚æ•°æ”¯æŒ
- âœ… æ·»åŠ äº†ç©ºçŠ¶æ€å¤„ç†
- âœ… ç¬¦åˆ ApostropheCMS æ ‡å‡†å®ç°

---

**æ›´æ–°æ—¥æœŸ**: 2024-10-11  
**ä¾æ®**: ApostropheCMS å®˜æ–¹æ–‡æ¡£  
**çŠ¶æ€**: âœ… å®Œæˆå¹¶éªŒè¯

